webpackJsonp([0],[,,,,,,,,,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="VIEW_POINT_SELECTED"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WATERNORMALS_TEXTURE=r.p+"textures/waternormals.jpg",t.VIEW_POINT_TEXTURE=r.p+"img/camera.png",t.DEFAULT_BACKGROUND_TEXTURE=r.p+"img/box.png"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="WEBVR_MODEL_CHANGE"},,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),r(8);var a=i(r(90)),o=i(r(92)),n=i(r(101)),l=i(r(115));t.default=(0,a.default)().then(o.default).then(function(){return Promise.all([(0,n.default)(),(0,l.default)()])})},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(r(1)),o=i(r(2)),n=i(r(12));t.default=function(e){var t=e.prevId,r=e.id,i=o.default.viewPoints[t]||null,l=o.default.viewPoints[r]||{};a.default.dispatch({type:n.default,prevPoint:i,point:l})}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.pos;if(t){f.set(t.x,t.y,t.z);var r={x:u.default.dollyCamera.position.x,y:u.default.dollyCamera.position.y,z:u.default.dollyCamera.position.z},i=u.default.dollyCamera.position.distanceTo(f)/s.default*1e3,a=new n.default.Tween(r).to(f,i);a.onUpdate(function(){u.default.dollyCamera.position.x=r.x,u.default.dollyCamera.position.y=r.y,u.default.dollyCamera.position.z=r.z}),a.start()}}function o(){c&&l.default.unregister(c),c=function(e){switch(e.type){case d.default:a({pos:e.point.pos,lookat:e.point.lookat})}},l.default.register(c)}Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(7)),l=i(r(1)),u=i(r(2)),s=i(r(91)),d=i(r(12)),c=null,f=new e.Vector3;new e.Matrix4,new e.Vector3,new e.Quaternion,new e.Quaternion;t.default=function(){return u.default.dollyCamera=new e.PerspectiveCamera,u.default.dollyCamera.add(u.default.camera),u.default.scene.add(u.default.dollyCamera),o(),Promise.resolve()}}).call(t,r(0))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=2},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(r(2)),o=i(r(93)),n=i(r(94)),l=i(r(96));t.default=function(){return a.default.pivot=new o.default,a.default.scene.add(a.default.pivot.instance),a.default.crosshair=new n.default,a.default.pivot.add(a.default.crosshair.instance),a.default.progress=new l.default,a.default.pivot.add(a.default.progress.instance),Promise.resolve()}},function(e,t,r){"use strict";(function(e){function r(){this.instance=new e.Object3D}Object.defineProperty(t,"__esModule",{value:!0});var i=new e.Vector3(0,0,1),a=new e.Vector3,o=new e.Vector3;r.prototype.add=function(e){this.instance.add(e)},r.prototype.remove=function(e){this.instance.remove(e)},r.prototype.update=function(e,t){0!==this.instance.children.length&&(a.copy(i),a.applyQuaternion(e.quaternion),a.applyQuaternion(t.quaternion),a.normalize(),this.instance.quaternion.setFromUnitVectors(i,a),o.copy(t.position),o.y+=e.position.y,this.instance.position.copy(o))},t.default=r}).call(t,r(0))},function(e,t,r){"use strict";(function(e){function i(){var t=this.draw(),r=new e.Texture(t);r.needsUpdate=!0;var i=new e.SpriteMaterial({map:r});i.depthTest=!1;var o=new e.Sprite(i);o.scale.multiplyScalar(a.default.scale),o.position.z=-4,o.renderOrder=100,this.instance=o}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return e&&e.__esModule?e:{default:e}}(r(95));i.prototype.draw=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=a.default.size,e.height=a.default.size,t.lineWidth=a.default.lineWidth,t.strokeStyle=a.default.color,t.fillStyle=a.default.color,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=a.default.lineWidth,t.shadowColor=a.default.color;var r=e.width,i=e.height,o=r/2,n=i/2,l=a.default.size/2-a.default.lineWidth/2;return t.clearRect(0,0,r,i),t.beginPath(),t.arc(o,n,l,0,2*Math.PI),t.closePath(),t.fill(),e},t.default=i}).call(t,r(0))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={color:"#ffc01f",size:128,lineWidth:15,scale:.05}},function(e,t,r){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function a(){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=u.default.size,t.height=u.default.size;var i=u.default.lineWidth,a=u.default.lineWidth;r.lineWidth=i,r.strokeStyle=u.default.color,r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=a,r.shadowColor=u.default.color,this.ctx=r,this.width=t.width,this.height=t.height,this.x=this.width/2,this.y=this.height/2,this.radius=u.default.size/2-i/2-a,this.circum=2*Math.PI,this.start=Math.PI/-2,this.finish=100,this.curr=0,this.draw_to,this.isShowing=!1,this.registerCallback=null;var o=new e.Texture(t);o.needsUpdate=!0;var n=new e.SpriteMaterial({map:o});n.depthTest=!1;var l=new e.Sprite(n);l.scale.multiplyScalar(u.default.scale),l.position.z=-4,l.renderOrder=100,this.instance=l,this.toggle(!1),this.register()}Object.defineProperty(t,"__esModule",{value:!0});var o=i(r(1)),n=i(r(97)),l=i(r(98)),u=i(r(100)),s=i(r(29)),d=i(r(28)),c=i(r(11));a.prototype.register=function(){var e=this;this.unregister(),this.registerCallback=function(t){switch(t.type){case c.default:e.reset();break;case s.default:e.reset(),e.toggle(!0);break;case d.default:e.toggle(!1),e.reset()}},o.default.register(this.registerCallback)},a.prototype.unregister=function(){this.registerCallback&&(o.default.unregister(this.registerCallback),this.registerCallback=null)},a.prototype.toggle=function(e){this.isShowing=!!e,this.instance.visible=this.isShowing},a.prototype.reset=function(){this.curr=0,this.draw_to=void 0,(0,l.default)()},a.prototype.render=function(e){if(this.isShowing){var t=this.ctx;t.clearRect(0,0,this.width,this.height),t.beginPath(),t.arc(this.x,this.y,this.radius,this.start,this.draw_to,!1),t.stroke(),this.curr+=e/1e3*u.default.speed,this.curr<this.finish+1?(this.draw_to=this.circum*this.curr/100+this.start,this.instance.material.map.needsUpdate=!0):(0,n.default)()}},t.default=a}).call(t,r(0))},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(r(1)),o=i(r(11));t.default=function(){a.default.dispatch({type:o.default})}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(r(1)),o=i(r(99));t.default=function(){a.default.dispatch({type:o.default})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="CIRCULAR_PROGRESS_RESET"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={color:"#ffc01f",size:128,lineWidth:10,scale:.5,speed:70}},function(e,t,r){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function a(){return(0,n.default)("stage").then(function(){function e(){["backgrounds","floors"].forEach(function(e){if(l.default[e]){var t=Object.keys(l.default[e]);if(t.length>0){var i=l.default[e][t[0]];l.default.currentStage[e]=i.id,r.push(i.instance)}}})}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=[];return 0===t.length?(e(),r):(t.forEach(function(e){l.default[e.type]&&l.default[e.type][e.id]&&l.default[e.type][e.id].instance&&(l.default.currentStage[e.type]=e.id,r.push(l.default[e.type][e.id].instance))}),0===r.length&&e(),r)})}function o(e){e.forEach(function(e){l.default.scene.add(e)})}Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(3)),l=i(r(2)),u=i(r(102)),s=i(r(109));t.default=function(){return l.default.scene.add(new e.AmbientLight(4473924)),l.default.light=new e.DirectionalLight(16777147,1),l.default.light.position.set(-1,1,-1),l.default.scene.add(l.default.light),Promise.all([(0,u.default)(),(0,s.default)()]).then(a).then(o)}}).call(t,r(0))},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(r(3)),o=i(r(103)),n=i(r(2)),l=i(r(108));t.default=function(){return(0,a.default)("backgrounds").then(function(e){return e&&0!==e.length||(e=[l.default]),e}).then(o.default).then(function(e){e.forEach(function(e){n.default.backgrounds[e.id]=e})}).catch(function(e){console.error(e)})}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=Promise.resolve(null),r={texture:e.texture};switch(e.type){case"cubemap":t=(0,o.default)(r);break;case"panorama":t=(0,n.default)(r);break;case"repeatWrap":t=(0,l.default)(r)}return t}Object.defineProperty(t,"__esModule",{value:!0});var o=i(r(104)),n=i(r(105)),l=i(r(106));t.default=function(e){var t=[];return e.forEach(function(e){var r=a(e).catch(function(t){return console.error(e.id+": "+t),null});t.push(r)}),Promise.all(t).then(function(t){var r=[];return t.forEach(function(t,i){t&&r.push(Object.assign(t,{id:e[i].id||i}))}),r})}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){if(!t.texture)return Promise.reject("No texture provided");var r=new e.CubeTexture([]);r.format=e.RGBFormat,(new e.ImageLoader).load(t.texture,function(e){var t=function(t,r){var i=document.createElement("canvas");return i.width=1024,i.height=1024,i.getContext("2d").drawImage(e,1024*-t,1024*-r),i};r.images[0]=t(2,1),r.images[1]=t(0,1),r.images[2]=t(1,0),r.images[3]=t(1,2),r.images[4]=t(1,1),r.images[5]=t(3,1),r.needsUpdate=!0});var i=e.ShaderLib.cube;i.uniforms.tCube.value=r;var a=new e.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:i.uniforms,depthWrite:!1,side:e.BackSide}),o=new e.Mesh(new e.BoxGeometry(1e3,1e3,1e3),a);return Promise.resolve({instance:o})}}).call(t,r(0))},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){if(!t.texture)return Promise.reject("No texture provided");var r=new e.SphereBufferGeometry(500,60,40);r.scale(-1,1,1);var i=new e.MeshBasicMaterial({map:(new e.TextureLoader).load(t.texture)}),a=new e.Mesh(r,i);return Promise.resolve({instance:a})}}).call(t,r(0))},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(r(107));t.default=function(t){if(!t.texture)return Promise.reject("No texture provided");var r=(new e.TextureLoader).load(t.texture,function(t){t.wrapS=e.RepeatWrapping,t.wrapT=e.RepeatWrapping,t.repeat.set(i.default,i.default)}),a=new e.BoxGeometry(i.default,i.default,i.default),o=new e.MeshBasicMaterial({map:r,color:114176,side:e.BackSide}),n=new e.Mesh(a,o);return n.position.y=i.default/2-.5,Promise.resolve({instance:n})}}).call(t,r(0))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=50},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(13);t.default={id:"default",type:"repeatWrap",texture:i.DEFAULT_BACKGROUND_TEXTURE}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(r(3)),o=i(r(2)),n=i(r(110));t.default=function(){return(0,a.default)("floors").then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,n.default)(e)}).then(function(e){e.forEach(function(e){o.default.floors[e.id]=e})}).catch(function(e){console.error(e)})}},function(e,t,r){"use strict";function i(e){var t=Promise.resolve(null);switch(e.type){case"water":t=(0,a.default)()}return t}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return e&&e.__esModule?e:{default:e}}(r(111));t.default=function(e){var t=[];return e.forEach(function(e){var r=i(e).catch(function(t){return console.error(e.id+": "+t),null});t.push(r)}),Promise.all(t).then(function(t){var r=[];return t.forEach(function(t,i){t&&r.push(Object.assign(t,{id:e[i].id||i}))}),r})}},function(e,t,r){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),r(112),r(113);var a=i(r(2)),o=i(r(114));t.default=function(){var t=(new e.TextureLoader).load(o.default.texture);t.wrapS=t.wrapT=e.RepeatWrapping;var r=new e.Water(a.default.renderer,a.default.camera,a.default.scene,{textureWidth:512,textureHeight:512,waterNormals:t,alpha:1,sunDirection:a.default.light.position.clone().normalize(),sunColor:16777215,waterColor:7695,distortionScale:2,fog:void 0!=a.default.scene.fog}),i=new e.Mesh(new e.PlaneBufferGeometry(o.default.width,o.default.height),r.material);return i.add(r),i.rotation.x=.5*-Math.PI,Promise.resolve({instance:i,render:function(e){r.material.uniforms.time.value+=2e-4*e,r.render()}})}}).call(t,r(0))},function(e,t,r){(function(e){e.Mirror=function(t,r,i){function a(e){o.updateMatrixWorld(),h.setFromMatrixPosition(o.matrixWorld),m.setFromMatrixPosition(e.matrixWorld),p.extractRotation(o.matrixWorld),f.set(0,0,1),f.applyMatrix4(p),y.subVectors(h,m),y.reflect(f).negate(),y.add(h),p.extractRotation(e.matrixWorld),v.set(0,0,-1),v.applyMatrix4(p),v.add(m),w.subVectors(h,v),w.reflect(f).negate(),w.add(h),P.position.copy(y),P.up.set(0,1,0),P.up.applyMatrix4(p),P.up.reflect(f),P.lookAt(w),P.aspect=e.aspect,P.near=e.near,P.far=e.far,P.updateMatrixWorld(),P.updateProjectionMatrix(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(P.projectionMatrix),M.multiply(P.matrixWorldInverse),c.setFromNormalAndCoplanarPoint(f,h),c.applyMatrix4(P.matrixWorldInverse),g.set(c.normal.x,c.normal.y,c.normal.z,c.constant);var t=P.projectionMatrix;x.x=(Math.sign(g.x)+t.elements[8])/t.elements[0],x.y=(Math.sign(g.y)+t.elements[9])/t.elements[5],x.z=-1,x.w=(1+t.elements[10])/t.elements[14],g.multiplyScalar(2/g.dot(x)),t.elements[2]=g.x,t.elements[6]=g.y,t.elements[10]=g.z+1-s,t.elements[14]=g.w}e.Mesh.call(this,new e.PlaneBufferGeometry(t,r));var o=this;o.name="mirror_"+o.id,o.matrixNeedsUpdate=!0,i=i||{};var n=new e.Vector4,l=void 0!==i.textureWidth?i.textureWidth:512,u=void 0!==i.textureHeight?i.textureHeight:512,s=void 0!==i.clipBias?i.clipBias:0,d=void 0!==i.color?new e.Color(i.color):new e.Color(8355711),c=new e.Plane,f=new e.Vector3,h=new e.Vector3,m=new e.Vector3,p=new e.Matrix4,v=new e.Vector3(0,0,-1),g=new e.Vector4,y=new e.Vector3,w=new e.Vector3,x=new e.Vector4,M=new e.Matrix4,P=new e.PerspectiveCamera,_={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat,stencilBuffer:!1},b=new e.WebGLRenderTarget(l,u,_);e.Math.isPowerOfTwo(l)&&e.Math.isPowerOfTwo(u)||(b.texture.generateMipmaps=!1);var C={uniforms:{mirrorColor:{value:new e.Color(8355711)},mirrorSampler:{value:null},textureMatrix:{value:new e.Matrix4}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 mirrorCoord;","void main() {","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tmirrorCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 mirrorColor;","uniform sampler2D mirrorSampler;","varying vec4 mirrorCoord;","float blendOverlay(float base, float blend) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","void main() {","\tvec4 color = texture2DProj(mirrorSampler, mirrorCoord);","\tcolor = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g), blendOverlay(mirrorColor.b, color.b), 1.0);","\tgl_FragColor = color;","}"].join("\n")},S=e.UniformsUtils.clone(C.uniforms),O=new e.ShaderMaterial({fragmentShader:C.fragmentShader,vertexShader:C.vertexShader,uniforms:S});O.uniforms.mirrorSampler.value=b.texture,O.uniforms.mirrorColor.value=d,O.uniforms.textureMatrix.value=M,o.material=O,o.onBeforeRender=function(e,t,r){a(r),o.visible=!1;var i=e.getRenderTarget(),l=e.vr.enabled,u=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.render(t,P,b,!0),e.vr.enabled=l,e.shadowMap.autoUpdate=u,e.setRenderTarget(i);var s=r.bounds;if(void 0!==s){var d=e.getSize(),c=e.getPixelRatio();n.x=s.x*d.width*c,n.y=s.y*d.height*c,n.z=s.z*d.width*c,n.w=s.w*d.height*c,e.state.viewport(n)}o.visible=!0}},e.Mirror.prototype=Object.create(e.Mesh.prototype)}).call(t,r(0))},function(e,t,r){(function(e){e.Water=function(t,r,i,a){function o(e,t){return void 0!==e?e:t}e.Object3D.call(this),this.name="water_"+this.id,a=a||{},this.matrixNeedsUpdate=!0;var n=o(a.textureWidth,512),l=o(a.textureHeight,512);this.clipBias=o(a.clipBias,0),this.alpha=o(a.alpha,1),this.time=o(a.time,0),this.normalSampler=o(a.waterNormals,null),this.sunDirection=o(a.sunDirection,new e.Vector3(.70707,.70707,0)),this.sunColor=new e.Color(o(a.sunColor,16777215)),this.waterColor=new e.Color(o(a.waterColor,8355711)),this.eye=o(a.eye,new e.Vector3(0,0,0)),this.distortionScale=o(a.distortionScale,20),this.side=o(a.side,e.FrontSide),this.fog=o(a.fog,!1),this.renderer=t,this.scene=i,this.mirrorPlane=new e.Plane,this.normal=new e.Vector3(0,0,1),this.mirrorWorldPosition=new e.Vector3,this.cameraWorldPosition=new e.Vector3,this.rotationMatrix=new e.Matrix4,this.lookAtPosition=new e.Vector3(0,0,-1),this.clipPlane=new e.Vector4,r instanceof e.PerspectiveCamera?this.camera=r:(this.camera=new e.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new e.Matrix4,this.mirrorCamera=this.camera.clone(),this.renderTarget=new e.WebGLRenderTarget(n,l),this.renderTarget2=new e.WebGLRenderTarget(n,l);var u={uniforms:e.UniformsUtils.merge([e.UniformsLib.fog,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},distortionScale:{value:20},noiseScale:{value:1},textureMatrix:{value:new e.Matrix4},sunColor:{value:new e.Color(8355711)},sunDirection:{value:new e.Vector3(.70707,.70707,0)},eye:{value:new e.Vector3},waterColor:{value:new e.Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec3 worldPosition;",e.ShaderChunk.fog_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyz;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",e.ShaderChunk.fog_vertex,"}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec3 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",e.ShaderChunk.common,e.ShaderChunk.fog_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( sunColor * diffuseLight * 0.3 + scatter, ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance );","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",e.ShaderChunk.fog_fragment,"}"].join("\n")},s=e.UniformsUtils.clone(u.uniforms);this.material=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:s,transparent:!0,side:this.side,fog:this.fog}),this.material.uniforms.mirrorSampler.value=this.renderTarget.texture,this.material.uniforms.textureMatrix.value=this.textureMatrix,this.material.uniforms.alpha.value=this.alpha,this.material.uniforms.time.value=this.time,this.material.uniforms.normalSampler.value=this.normalSampler,this.material.uniforms.sunColor.value=this.sunColor,this.material.uniforms.waterColor.value=this.waterColor,this.material.uniforms.sunDirection.value=this.sunDirection,this.material.uniforms.distortionScale.value=this.distortionScale,this.material.uniforms.eye.value=this.eye,e.Math.isPowerOfTwo(n)&&e.Math.isPowerOfTwo(l)||(this.renderTarget.texture.generateMipmaps=!1,this.renderTarget.texture.minFilter=e.LinearFilter,this.renderTarget2.texture.generateMipmaps=!1,this.renderTarget2.texture.minFilter=e.LinearFilter),this.updateTextureMatrix(),this.render()},e.Water.prototype=Object.create(e.Object3D.prototype),e.Water.prototype.constructor=e.Water,e.Water.prototype.render=function(){this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0;for(var t=this;null!==t.parent;)t=t.parent;void 0!==t&&t instanceof e.Scene&&(this.material.visible=!1,this.renderer.render(t,this.mirrorCamera,this.renderTarget,!0),this.material.visible=!0)},e.Water.prototype.updateTextureMatrix=function(){this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix);var t=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition);t.reflect(this.normal).negate(),t.add(this.mirrorWorldPosition),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var r=this.mirrorWorldPosition.clone().sub(this.lookAtPosition);r.reflect(this.normal).negate(),r.add(this.mirrorWorldPosition),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(t),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(r),this.mirrorCamera.aspect=this.camera.aspect,this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mirrorWorldPosition),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var i=new e.Vector4,a=this.mirrorCamera.projectionMatrix;i.x=(Math.sign(this.clipPlane.x)+a.elements[8])/a.elements[0],i.y=(Math.sign(this.clipPlane.y)+a.elements[9])/a.elements[5],i.z=-1,i.w=(1+a.elements[10])/a.elements[14];var o=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(i));a.elements[2]=o.x,a.elements[6]=o.y,a.elements[10]=o.z+1-this.clipBias,a.elements[14]=o.w;var n=new e.Vector3;n.setFromMatrixPosition(this.camera.matrixWorld),this.eye=n,this.material.uniforms.eye.value=this.eye}}).call(t,r(0))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(13);t.default={width:200,height:200,texture:i.WATERNORMALS_TEXTURE}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(){return(0,l.default)("cast").then(function(){function e(){t(),r()}function t(){["models"].forEach(function(e){if(u.default[e]){var t=Object.keys(u.default[e]);if(t.length>0){var r=u.default[e][t[0]];a.push({type:e,id:r.id})}}})}function r(){["viewPoints"].forEach(function(e){if(!n.default.findWhere(a,{type:e})){var t,r=(n.default.findWhere(a,{type:"models"})||{}).id;return u.default.modelBind[r]&&u.default.modelBind[r][e]&&(t=n.default.find(u.default.modelBind[r][e],function(t){return!!n.default.findWhere(u.default[e],{id:t})})),t?a.push({type:e,id:t}):void 0}})}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=[];if(0===i.length)return e(),a;var o=n.default.groupBy(i,function(e){return n.default.contains(["models"],e.type)?"main":n.default.contains(["viewPoints"],e.type)?"modelDep":void 0});return n.default.each(o.main,function(e){u.default[e.type]&&u.default[e.type][e.id]&&a.push({type:e.type,id:e.id})}),n.default.each(o.modelDep,function(e){var t=(n.default.findWhere(a,{type:"models"})||{}).id;u.default[e.type]&&u.default[e.type][e.id]&&u.default.modelBind[t]&&u.default.modelBind[t][e.type]&&n.default.contains(u.default.modelBind[t][e.type],e.id)&&a.push({type:e.type,id:e.id})}),0===a.length&&e(),r(),a})}function o(e){e.forEach(function(e){var t=u.default.currentStage[e.type];switch(u.default.currentStage[e.type]=e.id,e.type){case"models":(0,f.default)({prevId:t,id:e.id});break;case"viewPoints":(0,h.default)({prevId:t,id:e.id})}})}Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(5)),l=i(r(3)),u=i(r(2)),s=i(r(116)),d=i(r(117)),c=i(r(121)),f=i(r(122)),h=i(r(38));t.default=function(){return Promise.all([(0,s.default)(),(0,d.default)(),(0,c.default)()]).then(a).then(o)}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.target,r=e.mode;if(d.default.models[t]){var i=d.default.models[t].instance.get(d.default.cache);switch(r){case 0:d.default.models[t].instance.idle=!0,d.default.scene.remove(i);break;case 1:d.default.models[t].instance.idle=!1,d.default.scene.add(i)}}}function o(){f&&n.default.unregister(f),f=function(e){switch(e.type){case c.default:a({target:e.prevModelId,mode:0}),a({target:e.modelId,mode:1})}},n.default.register(f)}Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(1)),l=i(r(3)),u=i(r(19)),s=i(r(18)),d=i(r(2)),c=i(r(14)),f=null;t.default=function(){return(0,l.default)("models").then(function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e,t){var r=e.id||t,i=Object.assign({},e,{id:r,title:e.title||s.default.title,referenceSize:e.referenceSize||s.default.referenceSize,scaleFactor:e.scaleFactor||s.default.scaleFactor}),a={instance:new u.default(i)};d.default.models[r]=Object.assign(i,a)})}).then(function(){o()}).catch(function(e){console.error(e)})}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.target,r=e.mode;s.default.modelBind[t]&&s.default.modelBind[t].viewPoints&&s.default.modelBind[t].viewPoints.forEach(function(e){if(s.default.viewPoints[e]){var t=s.default.viewPoints[e].instance.get(s.default.cache);switch(r){case 0:w(t),s.default.viewPoints[e].instance.idle=!0,s.default.scene.remove(t);break;case 1:t.userData.scanTukanWebvrRaycastInfo={type:"viewPoints",id:e},y(t),s.default.viewPoints[e].instance.idle=!1,s.default.scene.add(t)}}})}function o(e){var t=e.prevPoint,r=e.point;t&&(v&&(clearTimeout(v),g()),g=function(){t.instance.get(s.default.cache).visible=!0,v=null},v=setTimeout(g,500)),r.instance.get(s.default.cache).visible=!1}function n(){p&&l.default.unregister(p),p=function(e){switch(e.type){case f.default:a({target:e.prevModelId,mode:0}),a({target:e.modelId,mode:1});break;case h.default:o({prevPoint:e.prevPoint,point:e.point});break;case m.default:if("viewPoints"===e.target.type){var t=s.default.currentStage.viewPoints;s.default.currentStage.viewPoints=e.target.id,(0,c.default)({prevId:t,id:e.target.id})}}},l.default.register(p)}Object.defineProperty(t,"__esModule",{value:!0});var l=i(r(1)),u=i(r(3)),s=i(r(2)),d=i(r(118)),c=i(r(38)),f=i(r(14)),h=i(r(12)),m=i(r(30)),p=null,v=null,g=null,y=function(e){return s.default.raycastInstances.push(e)},w=function(e){var t=s.default.raycastInstances.indexOf(e);t>-1&&s.default.raycastInstances.splice(t,1)};t.default=function(){return(0,u.default)("viewPoints").then(function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e,t){var r=e.id||t,i=Object.assign(e,{id:r,pos:e.pos}),a={instance:new d.default(i)};s.default.viewPoints[r]=Object.assign(i,a)})}).then(function(){n()}).catch(function(e){console.error(e)})}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e){o.default.apply(this,arguments),this._cacheType="viewPoints"}Object.defineProperty(t,"__esModule",{value:!0});var o=i(r(24)),n=i(r(119));(a.prototype=Object.create(o.default.prototype)).constructor=a,a.prototype.create=function(){var e=this;o.default.prototype.create.apply(e),(0,n.default)(e.props).then(function(t){e._instance&&(t.userData.parent=e._instance,e._instance.add(t))}).catch(function(e){console.error(e)})},t.default=a},function(e,t,r){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return e<n.default.standing?n.default.standing:e}Object.defineProperty(t,"__esModule",{value:!0});var o=i(r(120)),n=i(r(36)),l=null;t.default=function(t){var r=t.pos;l||(l=new e.SpriteMaterial({map:(new e.TextureLoader).load(o.default.texture)}));var i=new e.Sprite(l);return i.position.set(r.x,a(r.y),r.z),i.scale.multiplyScalar(.5),Promise.resolve(i)}}).call(t,r(0))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(13);t.default={texture:i.VIEW_POINT_TEXTURE}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(r(3)),o=i(r(2));t.default=function(){return(0,a.default)("modelBind").then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o.default.modelBind=e})}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(r(1)),o=i(r(2)),n=i(r(14));t.default=function(e){var t=e.prevId||null,r=e.id||Object.keys(o.default.models)[0];a.default.dispatch({type:n.default,prevModelId:t,modelId:r})}}],[37]);